<link rel="import" href="../third_party/polymer/polymer-element.html">
<dom-module id="shapeviewer-element">

  <template>
    <style>
      :host {
        display: block;
        overflow: auto;
        min-width: 0;
        min-height: 0;
      }
    </style>
    <canvas id="canvas">
    </canvas>
  </template>
  <script>
    class ShapeViewerElement extends Polymer.Element {
      static get is() { return "shapeviewer-element"; }

      constructor() {
        super();
        this.textContent = "hello world";
        this.shape_ = undefined;
        this.selectedLayer_ = undefined;
      }

      get shape() {
        return this.shape_;
      }

      set shape(shape) {
        this.shape_ = shape;
        this.redraw_();
      }

      get selectedLayer() {
        return this.selectedLayer_;
      }
      set selectedLayer(selectedLayer) {
        this.selectedLayer_ = selectedLayer;
        this.redraw_();
      }

      redraw_() {
        //let r = this.getBoundingClientRect();
        //this.$.canvas.width = r.width;
        //this.$.canvas.height = r.height;
        this.$.canvas.width = 300;
        this.$.canvas.height = 600;

        var ctx = this.$.canvas.getContext('2d');

        var dpr = window.devicePixelRatio;
        var w = this.$.canvas.width * dpr;
        var h = this.$.canvas.height * dpr;

        var smallestSide = Math.min(w,h);
        var modelToScreenScaleFactor = smallestSide;

        ctx.clearRect(0,0,w,h);

        var shape = this.shape_;
        if (!shape)
          return;

        ctx.strokeWidth = '2px';
        shape.layers.forEach(function(layer) {
          if (layer === this.selectedLayer) {
            ctx.strokeStyle = 'rgba(2555, 0, 0, 1)';
            ctx.fillStyle = 'rgba(255, 0, 0, 0.05)';
          } else {
            ctx.strokeStyle = 'rgba(0, 255, 0, 1)';
            ctx.fillStyle = 'rgba(0, 255, 0, 0.05)';
          }
          ctx.fillRect(layer.dstX * modelToScreenScaleFactor,
                         layer.dstY * modelToScreenScaleFactor,
                         layer.dstWidth * modelToScreenScaleFactor,
                         layer.dstHeight * modelToScreenScaleFactor);
          ctx.strokeRect(layer.dstX * modelToScreenScaleFactor,
                         layer.dstY * modelToScreenScaleFactor,
                         layer.dstWidth * modelToScreenScaleFactor,
                         layer.dstHeight * modelToScreenScaleFactor);
        }, this);
      }
    }
    customElements.define(ShapeViewerElement.is, ShapeViewerElement);
  </script>
</dom-module>